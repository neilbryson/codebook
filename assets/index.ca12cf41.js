var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,l=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,n=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&l(e,r,t[r]);if(a)for(var r of a(t))c.call(t,r)&&l(e,r,t[r]);return e},s=(e,a)=>t(e,r(a)),d=(e,t)=>{var r={};for(var l in e)o.call(e,l)&&t.indexOf(l)<0&&(r[l]=e[l]);if(null!=e&&a)for(var l of a(e))t.indexOf(l)<0&&c.call(e,l)&&(r[l]=e[l]);return r};import{r as u,R as i,c as m,a as E,b as f,d as p,e as g,t as h,u as b,C,f as v,g as D,h as O,N as T,P as _,i as x,j as y}from"./vendor.a6849b0c.js";var S,I;(I=S||(S={})).LIGHT="light",I.DARK="dark";const L=u.exports.createContext({changeTheme:()=>{},currentTheme:S.DARK}),R=()=>u.exports.useContext(L),N=({children:e})=>{const[t,r]=u.exports.useState(S.LIGHT),a=u.exports.useCallback((e=>{"dark"===e?(document.documentElement.classList.add("dark"),localStorage.setItem("codebook-theme","dark"),r(S.DARK)):(document.documentElement.classList.remove("dark"),localStorage.setItem("codebook-theme","light"),r(S.LIGHT))}),[]),o=u.exports.useMemo((()=>({changeTheme:a,currentTheme:t})),[a,t]);return u.exports.useLayoutEffect((()=>{const e=localStorage.getItem("codebook-theme");if("dark"===e||null===e&&window.matchMedia("(prefers-color-scheme: dark)").matches)return document.documentElement.classList.add("dark"),void r(S.DARK);document.documentElement.classList.remove("dark"),r(S.LIGHT)}),[]),i.createElement(L.Provider,{value:o},e)};var k,w;(w=k||(k={})).ADD_CODE_START="code/ADD_CODE_START",w.ADD_CODE_SUCCESS="code/ADD_CODE_SUCCESS",w.ADD_CODE_ERROR="code/ADD_CODE_ERROR",w.GET_CODE_LIST_START="code/GET_CODE_LIST_START",w.GET_CODE_LIST_SUCCESS="code/GET_CODE_LIST_SUCCESS",w.GET_CODE_LIST_ERROR="code/GET_CODE_LIST_ERROR";const A={codeIds:[],codeList:{}};const G={code:function(e=A,t){switch(t.type){case k.ADD_CODE_SUCCESS:{const r=t.payload.id;return s(n({},e),{codeIds:[...e.codeIds,r],codeList:s(n({},e.codeList),{[r]:t.payload})})}case k.GET_CODE_LIST_SUCCESS:{const{codeIds:r,codeList:a}=t.payload.reduce(((e,t)=>(e.codeIds.push(t.id),e.codeList[t.id]=t,e)),{codeIds:[],codeList:{}});return s(n({},e),{codeList:a,codeIds:r})}default:return e}}};var M,j;(j=M||(M={})).HOME="route/HOME",j.CODE_EDITOR="route/CODE_EDITOR";const H={[M.HOME]:{path:"/"},[M.CODE_EDITOR]:{path:"/code/:id?"}},{reducer:P,middleware:U,enhancer:K}=m(H,{basename:"https://neilbryson.github.io/codebook/"}),$=g(E(s(n({},G),{location:P})),p(K,f(h,U))),B=b,z=e=>{var t=e,{className:r}=t,a=d(t,["className"]);return i.createElement("button",n({className:`outline-none border-0 p-2.5 font-medium text-lg bg-blue-600 text-gray-100 rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:text-gray-200 disabled:cursor-not-allowed ${r}`},a))},F=e=>{var t=e,{className:r}=t,a=d(t,["className"]);return i.createElement("input",n({className:`border-0 text-gray-800 p-1.5 ${r}`},a))};function V(e){switch((e.split(".").pop()||"").toLowerCase()){case"css":return"text/css";case"html":return"text/html";case"js":return"text/javascript";case"ts":case"tsx":return"text/typescript";default:return""}}const q=()=>{var e,t;const{currentTheme:r}=R(),a=u.exports.useRef(null),o=u.exports.useRef(null),{codeIds:c,codeList:l,locationPayload:n}=B((e=>({codeIds:e.code.codeIds,codeList:e.code.codeList,locationPayload:e.location.payload}))),s=u.exports.useMemo((()=>"string"==typeof n.id&&c.includes(n.id)?l[n.id]:null),[n,c,l]),[d,m]=u.exports.useState(null!=(e=null==s?void 0:s.fileName)?e:""),[E,f]=u.exports.useState(null!=(t=null==s?void 0:s.source)?t:""),p=u.exports.useCallback(((e,t)=>{f(e.getValue())}),[]);return u.exports.useEffect((()=>{var e;a.current&&!o.current&&(o.current=C(a.current,{mode:(null==s?void 0:s.fileName)?V(s.fileName):"",value:null!=(e=null==s?void 0:s.source)?e:"",lineNumbers:!0}),o.current.setSize("100%","100%"),o.current.on("change",p))}),[s,p]),u.exports.useEffect((()=>{var e,t;m(null!=(e=null==s?void 0:s.fileName)?e:""),o.current&&o.current.setValue(null!=(t=null==s?void 0:s.source)?t:"")}),[s]),u.exports.useEffect((()=>{if(o.current){const e=r===S.DARK?"darcula":"idea";o.current.setOption("theme",e)}}),[r]),i.createElement("section",{className:"h-full flex flex-col"},i.createElement("div",{className:"flex items-center content-center mb-4"},i.createElement(F,{className:"w-full font-bold mr-4",placeholder:"File name",onBlur:function(e){if(!e.target.value)return;const t=V(e.target.value);o.current&&o.current.setOption("mode",t)},onChange:function(e){m(e.target.value)},value:d,title:"File name"}),i.createElement(z,{className:"mr-4 last:mr-0",title:"Save"},"💾"),(null==s?void 0:s.id)&&i.createElement(z,{title:"Delete"},"🗑️")),i.createElement("div",{className:"h-full mb-4 overflow-hidden",ref:a}))},J=e=>{var t=e,{codeId:r,dateLastModified:a,fileName:o}=t,c=d(t,["codeId","dateLastModified","fileName"]);return i.createElement("div",n({className:"border border-gray-800 rounded p-2 cursor-pointer hover:bg-gray-300 dark:border-gray-100 dark:hover:bg-gray-700"},c),i.createElement("h2",{className:"text-lg font-bold"},o),i.createElement("span",null,v(a).fromNow()))},Q={baseURL:"://:",headers:{"Content-Type":"application/json"},timeout:25e3};function W(e=0,t=1,r=!0){return async a=>{a({type:k.GET_CODE_LIST_START});const o=r?1:0;try{const{data:r}=await function(e={}){const t=s(n(n({},Q),e),{headers:n(n({},Q.headers),e.headers)});return D.request(t)}({url:`/api/v1/code?sortBy=${o}&pageSize=${e}&pageNumber=${t}`,method:"get"});a({payload:r,type:k.GET_CODE_LIST_SUCCESS})}catch(c){a({type:k.GET_CODE_LIST_ERROR})}}}function X(e,t={},r){return{meta:r,payload:t,type:e}}const Y=()=>{const e=O(),{codeIds:t,codeList:r}=B((e=>({codeIds:e.code.codeIds,codeList:e.code.codeList})));function a(t){return()=>e(X(M.CODE_EDITOR,{id:t}))}return u.exports.useEffect((()=>{e(W())}),[e]),i.createElement("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4"},t.map((e=>{const{dateLastModified:t,fileName:o}=r[e];return i.createElement(J,{codeId:e,dateLastModified:t,fileName:o,key:e,onClick:a(e)})})))},Z=()=>i.createElement("div",{className:"h-5 w-px bg-gray-800 dark:bg-gray-200 ml-2 mr-2"}),ee=()=>{const{changeTheme:e,currentTheme:t}=R();function r(){t===S.DARK?e(S.LIGHT):e(S.DARK)}return i.createElement("div",{onClick:r,title:"Click to toggle theme"},i.createElement("span",{className:"cursor-pointer select-none text-2xl",onClick:r},t===S.LIGHT?"🌞":"🌜"))},te=()=>{const e=O();return i.createElement("section",{className:"text-gray-200 bg-gray-600 h-12 flex items-center justify-between pl-8 pr-8"},i.createElement("h1",{className:"text-3xl cursor-pointer",title:"Codebook home",onClick:function(){e(X(M.HOME))}},"Codebook"),i.createElement("div",{className:"flex items-center"},i.createElement("span",{className:"text-2xl cursor-pointer",onClick:function(){e(X(M.CODE_EDITOR))}},"➕"),i.createElement(Z,null),i.createElement(ee,null)))},re=({children:e})=>i.createElement("div",{className:"flex flex-col h-full w-full"},i.createElement(te,null),i.createElement("div",{className:"mt-4 ml-8 mr-8 mb-4 h-full overflow-auto"},e));function ae(e){return i.createElement(re,null,e)}const oe=()=>{switch(B((e=>e.location.type))){case M.HOME:return ae(i.createElement(Y,null));case M.CODE_EDITOR:return ae(i.createElement(q,null));case T:default:return null}},ce=()=>i.createElement(_,{store:$},i.createElement(N,null,i.createElement("div",{className:"w-screen h-screen bg-gray-200 text-gray-800 dark:bg-gray-800 dark:text-gray-100"},i.createElement(oe,null))));v.extend(x),y.render(i.createElement(i.StrictMode,null,i.createElement(ce,null)),document.getElementById("app"));
